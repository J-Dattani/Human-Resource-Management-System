Authoritative state model definition for the Dayflow HRMS project
This document defines all application states, where they live, how they change, and who is allowed to modify them, strictly for a PHP page‑based architecture.

This file exists to prevent:

Inconsistent behavior

Hidden or implicit state

SPA‑style state assumptions

AI hallucination of state managers

1. Purpose of This Document
The purpose of STATE_MODEL.md is to:

Explicitly define every state used in the system

Specify where state is stored (PHP session, server variables, request data)

Define valid state transitions

Clarify who controls state changes

Ensure state behavior is predictable and debuggable

If a state is not defined here, it must not exist.

2. State Storage Principles (Critical)
Dayflow follows these non‑negotiable state rules:

Primary state authority: PHP ($_SESSION)

Temporary input state: HTTP request ($_POST, $_GET)

UI-only state: JavaScript (non‑authoritative)

No client‑side global state

No SPA state containers

JavaScript may reflect state, never decide it.

3. Authentication State
3.1 Authentication State Definition
State Name	Description
authenticated	User is logged in
unauthenticated	User is not logged in
3.2 Authentication State Storage
Stored in PHP session:

$_SESSION['user_id']
Exists → authenticated

Not set → unauthenticated

3.3 Authentication State Transitions
unauthenticated → authenticated (login/signup)
authenticated → unauthenticated (logout / session destroy)
Only PHP may change authentication state.

4. Role State
4.1 Role State Definition
Role Value	Meaning
employee	Standard employee
admin	HR / Admin user
4.2 Role State Storage
Stored in PHP session:

$_SESSION['role']
This value:

Is set at login/signup

Must never change during a session

Must be validated on every protected page

4.3 Role State Rules
Role determines:

Accessible pages

Editable fields

Allowed actions

Role must never be inferred from UI

Role must always be verified server‑side

Invalid or missing role → force logout.

5. Navigation State
5.1 Navigation State Definition
Navigation state represents which page the user is currently viewing.

This state is:

Derived from the current PHP file

Not stored explicitly

Not persisted across sessions

5.2 Navigation Rules
Navigation is page‑based (*.php)

Back/forward buttons must not bypass auth checks

Direct URL access must always re‑validate session and role

6. Attendance State
6.1 Attendance State Definition
Each attendance record has exactly one of the following states:

State	Meaning
present	Employee was present
absent	Employee was absent
half_day	Partial presence
leave	On approved leave
6.2 Attendance State Storage
Stored as mock data (array / temporary storage)

Updated via PHP on form submission

Never controlled by JavaScript

Example (conceptual):

$attendance[$employee_id][$date] = 'present';
6.3 Attendance State Transitions
Valid transitions:

none → present
present → half_day
present → leave
leave → present
Rules:

Employee may only modify their own attendance

Admin may modify any attendance

Invalid transitions must be rejected by PHP

7. Leave State
7.1 Leave State Definition
Each leave request has exactly one state:

State	Meaning
pending	Awaiting admin decision
approved	Approved by admin
rejected	Rejected by admin
7.2 Leave State Storage
Stored as mock leave records managed by PHP.

Example:

$leave['status'] = 'pending';
7.3 Leave State Transitions
Valid transitions:

pending → approved
pending → rejected
Invalid transitions (forbidden):

approved → pending
rejected → pending
approved → rejected
Rules:

Only Admin can change leave state

Employee can never modify state after submission

State must be immutable once approved/rejected

8. Payroll State
8.1 Payroll State Definition
Payroll data is not transactional in this system.

Payroll has only display/edit state, not lifecycle state.

8.2 Payroll State Rules
Employee:

Read‑only access

Cannot submit changes

Admin:

Can edit payroll fields

Changes are applied immediately (mock)

No computed or derived payroll states exist.

9. Form Submission State
9.1 Form State Definition
Forms pass through these implicit states:

State	Description
idle	Form not submitted
submitted	POST request sent
validated	PHP validation passed
error	Validation failed
success	Data accepted
9.2 Form State Handling
PHP determines final state

JavaScript may:

Show loading indicators

Disable buttons temporarily

JavaScript must not determine success or failure

10. Error State
10.1 Error State Definition
Errors exist in two forms:

Validation errors (user input)

Access errors (auth/role)

10.2 Error State Rules
Errors must:

Be generated by PHP

Be shown in UI

Be human‑readable

Errors must never:

Leak technical details

Persist after correction

11. Session Termination State
11.1 Logout State
Logout action must:

session_destroy();
Results in:

authenticated → unauthenticated
All user‑specific state is cleared.

12. Forbidden State Patterns
The following are strictly forbidden:

Client‑side authoritative state

Hidden global JavaScript state

State inferred from UI alone

Automatic state transitions without user action

SPA‑style state containers

13. State Validation Rules (Mandatory)
Every PHP page must validate:

Authentication state

Role state

Ownership of data being modified

If validation fails:

Abort action

Redirect to login or dashboard

Show appropriate message

14. Relationship to Other Documents
This state model must align with:

APP_FLOW.md

USER_JOURNEYS.md

PROJECT_SPEC.md

PROJECT_SCOPE.md

CORE_SAFETY.md

If any conflict exists:

CORE_SAFETY.md has highest priority

15. Enforcement Rule
Any implementation that:

Uses undefined states

Allows invalid state transitions

Bypasses PHP session checks

Relies on JavaScript for authority

Is invalid and must be corrected.
